<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recommandeur d'Outils IA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="config.js"></script>

    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
</head>

<body class="bg-gray-50 min-h-screen p-8">
    <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-8">
        
        <h1 class="text-4xl font-bold text-gray-900 mb-2">Trouvez l'outil IA parfait</h1>
        <p class="text-gray-600 mb-8">R√©pondez √† 3 questions simples et d√©couvrez l'outil qui vous correspond</p>

        <form class="space-y-6">
            <div>
                <label for="domaine" class="block text-sm font-semibold text-gray-700 mb-3">
                    1. Quel est votre domaine d'utilisation ?
                </label>
                <select id="domaine" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <option value="">-- Choisir --</option>
                    <option value="redaction">R√©daction & Texte</option>
                    <option value="images">Images & Design</option>
                    <option value="video">Vid√©o & Avatar</option>
                    <option value="audio">Audio & Voix</option>
                    <option value="automatisation">Automatisation</option>
                    <option value="developpement">D√©veloppement</option>
                </select>
            </div>

            <div>
                <label for="technicite" class="block text-sm font-semibold text-gray-700 mb-3">
                    2. Quel est votre niveau de technicit√© ?
                </label>
                <select id="technicite" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <option value="">-- Choisir --</option>
                    <option value="debutant">D√©butant</option>
                    <option value="intermediaire">Interm√©diaire</option>
                    <option value="expert">Expert</option>
                </select>
            </div>

            <div>
                <label for="temps" class="block text-sm font-semibold text-gray-700 mb-3">
                    3. Combien de temps pouvez-vous y consacrer ?
                </label>
                <select id="temps" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <option value="">-- Choisir --</option>
                    <option value="rapide">Rapide (< 1h)</option>
                    <option value="moyen">Moyen (1-5h)</option>
                    <option value="long">Long (5h+)</option>
                </select>
            </div>
            <div class="flex items-center space-x-3 mb-6 p-3 bg-blue-50 rounded-md border border-blue-100">
                <input type="checkbox" id="free-only" class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 cursor-pointer">
                <label for="free-only" class="text-sm font-medium text-blue-900 cursor-pointer">
                    Afficher uniquement les outils avec une version **Gratuite / Freemium**
                </label>
            </div>

            <button id="bouton" type="button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-md transition">
                Voir ma recommandation
            </button>

            <div id="resultat" class="mt-8 p-6 bg-green-50 border border-green-200 rounded-lg hidden">
                <h2 class="text-2xl font-bold text-green-900 mb-2">Voil√† ta recommandation !</h2>
                <div id="texte-resultat" class="text-gray-700"></div>
            </div>
        </form>
    </div>

    <script>
    // 1. INITIALISATION
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // 2. CHARGEMENT DES DONN√âES DEPUIS FIRESTORE
    let outils = [];
    db.collection('outils').get().then((snapshot) => {
            outils = [];
            snapshot.forEach(doc => {
                outils.push(doc.data());
            });
            console.log('‚úÖ Outils charg√©s :', outils.length);
        })
        .catch(error => console.error('‚ùå Erreur Firestore :', error));

    // 3. L'ALGORITHME DE RECOMMANDATION
    function recommander(domaine, technicite, temps, freeOnly) {
    let outils_recommandes = [];
    
    // Ton mapping existant 
    const categorieMapping = {
        'redaction': 'Texte & R√©daction',
        'images': 'Images & Design',
        'video': 'Vid√©o & Avatar',
        'audio': 'Audio & Voix',
        'automatisation': 'Automatisation',
        'developpement': 'D√©veloppement'
    };

    const complexite_max = { 'debutant': 3, 'intermediaire': 6, 'expert': 10 };
    const categorie_attendue = categorieMapping[domaine];
    
    for (let outil of outils) {
        const matchCategorie = outil.category === categorie_attendue;
        const matchComplexite = outil.complexity <= complexite_max[technicite];
        
        // FILTRE S8 : Si freeOnly est coch√©, on v√©rifie has_free_tier. Sinon, on laisse passer.
        const matchFree = freeOnly ? outil.has_free_tier === true : true;

        if (matchCategorie && matchComplexite && matchFree) {
            outils_recommandes.push(outil);
        }
    }
    
    // Tri par score ou votes 
    outils_recommandes.sort((a, b) => (b.votes || 0) - (a.votes || 0));
    return outils_recommandes.slice(0, 3);
}

    // 4. √âCOUTEUR DU BOUTON
    const bouton = document.getElementById('bouton');
    const resultat = document.getElementById('resultat');
    const texteResultat = document.getElementById('texte-resultat');

    bouton.addEventListener('click', function() {
    const domaine = document.getElementById('domaine').value;
    const technicite = document.getElementById('technicite').value;
    const temps = document.getElementById('temps').value;
    // On r√©cup√®re si la case est coch√©e
    const freeOnly = document.getElementById('free-only').checked;

    if (domaine === '' || technicite === '' || temps === '') {
        alert('‚ö†Ô∏è Merci de r√©pondre √† toutes les questions !');
        return;
    }

    const resultat = document.getElementById('resultat');
    const texteResultat = document.getElementById('texte-resultat');

    // APPELER LA FONCTION DE RECOMMANDATION (on passe freeOnly en param√®tre)
    const recommandations = recommander(domaine, technicite, temps, freeOnly);

    if (recommandations.length === 0) {
        texteResultat.innerHTML = "<p class='text-gray-600 italic'>‚ùå Aucun outil trouv√© pour ces crit√®res. Essaie d'√©largir ta recherche ou de d√©cocher le filtre gratuit.</p>";
    } else {
        let html = "<h3 class='text-xl font-bold mb-4 text-green-900'>üéØ Top outils recommand√©s :</h3>";
        for (let outil of recommandations) {
            // On affiche le prix s'il existe, sinon un texte par d√©faut
            const prixAffiche = outil.pro_price || "Prix non renseign√©";
            
            html += `
                <div class="mb-4 p-4 bg-white border border-green-200 rounded-lg shadow-sm hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start mb-2">
                        <p class="font-bold text-lg text-blue-900">${outil.name}</p>
                        <span class="text-[10px] font-bold px-2 py-1 bg-blue-100 text-blue-700 rounded uppercase">
                            Pro : ${prixAffiche}
                        </span>
                    </div>
                    <p class="text-sm text-gray-700 mb-3">${outil.description}</p>
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-gray-500">Complexit√©: ${outil.complexity}/10</span>
                        <a href="${outil.website}" target="_blank" class="text-blue-600 font-bold text-sm hover:underline">Voir le site ‚Üí</a>
                    </div>
                </div>
            `;
        }
        texteResultat.innerHTML = html;
    }

    resultat.classList.remove('hidden');
});
    </script>
</body>
</html>